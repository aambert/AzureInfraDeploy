
parameters:
  servicePrin: #'AzureUsGov'
  deployRg: #'obodeploy'
  templateFile: #'Server.json'
  templateParamFile: #'Server_mag_srp_db_staging.parameters.json'

steps:

- task: AzurePowerShell@4
  displayName: 'Azure PowerShell script: Validate ARM Templates'
  inputs:
    azureSubscription: ${{ parameters.servicePrin }}
    scriptType: inlineScript
    inline: |
      # Test Server ARM template
      Test-AzResourceGroupDeployment `
      -ResourceGroupName ${{ parameters.deployRg }} `
      -Mode 'Incremental' `
      -TemplateParameterFile $(System.DefaultWorkingDirectory)\Templates\Server\${{ parameters.templateParamFile }} `
      -TemplateFile $(System.DefaultWorkingDirectory)\Templates\Server\${{ parameters.templateFile }} `
      -ErrorAction Stop
    errorActionPreference: stop
    failOnStandardError: true
    azurePowerShellVersion: latestVersion
